---
title: "GMRI Grants Summary - `r format(Sys.Date(), '%B %d, %Y')`"
format:
  html:
    toc: true
    toc-depth: 2
    df-print: paged
    theme: flatly
    code-fold: true
    title-block-banner: false
    title-block: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(knitr)
```

```{r, echo = FALSE, include  = FALSE}
# Load the most recent grants CSV
files <- list.files(here::here(), pattern = "^GMRI_Grants.csv$", full.names = TRUE)
latest_file <- sort(files, decreasing = TRUE)[1]

grants <- read_csv(latest_file)

# Ensure Posted and Deadline are dates
grants <- grants %>%
  mutate(
    Posted = mdy(Posted),
    Deadline = mdy(Deadline)
  )

# Create the formatted table
grants_out <- grants %>%
  arrange(Deadline) %>%
  mutate(
    Title = paste0("[", Title, "](", AdditionalInfoURL, ")"),
    Deadline = format(Deadline, "%b %d, %Y"),
    Posted = format(Posted, "%b %d, %Y"),
    Recent = if_else(
      as.Date(Posted, format = "%b %d, %Y") >= Sys.Date() - 7,
      "ðŸŸ¢ New",
      ""
    )
  ) %>%
  select(Agency, Title, Recent, Deadline, Posted) %>%
  kable()
```

```{r}
grants_out
```
