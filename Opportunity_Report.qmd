---
title: "GMRI Grants Summary - `r format(Sys.Date(), '%B %d, %Y')`"
format:
  html:
    toc: true
    toc-depth: 2
    df-print: paged
    theme: flatly
    code-fold: true
    title-block-banner: false
    title-block: false
---

```{css, echo=FALSE}
.navbar, .navbar-default {
  display: none !important;
}
body {
  padding-top: 0 !important;
}
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(knitr)
library(kableExtra)
```

```{r, echo = FALSE, include  = FALSE}
# Load the most recent grants CSV
files <- list.files(here::here(), pattern = "^GMRI_Grants.csv$", full.names = TRUE)
latest_file <- sort(files, decreasing = TRUE)[1]

grants <- read_csv(latest_file)

# Create the formatted table
grants_out <- grants %>%
  arrange(Deadline) %>%
  mutate(
    Title = paste0("[", Title, "](", AdditionalInfoURL, ")"),
    Deadline = format(Deadline, "%b %d, %Y"),
    Posted = format(Posted, "%b %d, %Y"),
    New = if_else(
      as.Date(Posted) >= Sys.Date() - 7,
      "<span style='color: white; background-color: #28a745; border-radius: 3px; padding: 2px 6px; font-weight: bold;'>ðŸŸ¢ New</span>",
      ""
    )
  ) |>
  select(Agency, Title, New, Deadline, Posted) |>
  arrange(desc(New), Deadline) 
 
```

```{r}
knitr::kable(grants_out, escape = FALSE)
```
