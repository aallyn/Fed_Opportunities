---
title: "GMRI Grants Summary - `r format(Sys.Date(), '%B %d, %Y')`"
format:
  html:
    toc: true
    toc-depth: 2
    df-print: paged
    theme: flatly
    code-fold: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(DT)
```

```{r, echo = FALSE, include  = FALSE}
# Load the most recent grants CSV
files <- list.files(here::here(), pattern = "^GMRI_Grants.csv$", full.names = TRUE)
latest_file <- sort(files, decreasing = TRUE)[1]

grants <- read_csv(latest_file)

grants_out <- grants %>%
  arrange(Deadline) %>%
  select(Agency, Title, Deadline, Posted, AdditionalInfoURL) %>%
  mutate(
    Title = paste0("[", Title, "](", AdditionalInfoURL, ")"),
    Recent = if_else(Posted >= Sys.Date() - 7,
                     '<span style="color:white; background-color:#28a745; padding:2px 6px; border-radius:4px;">New</span>',
                     "")
  ) %>%
  select(Agency, Title, Recent, Deadline, Posted) %>%
  knitr::kable(escape = FALSE)

grants_out <- grants %>%
  arrange(Deadline) %>%
  mutate(
    Title = paste0("<a href='", AdditionalInfoURL, "' target='_blank'>", Title, "</a>"),
    Recent = if_else(Posted >= Sys.Date() - 7,
                     '<span style="color:white; background-color:#28a745; padding:2px 6px; border-radius:4px;">New</span>',
                     "")
  ) %>%
  select(Agency, Title, Recent, Deadline, Posted)

grants_out<- datatable(
  grants_out,
  escape = FALSE,
  filter = "top",
  options = list(
    pageLength = 10,
    autoWidth = TRUE
  )
)
```

```{r}
grants_out
```
